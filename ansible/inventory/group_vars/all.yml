# Global variables for all hosts
---

# =============================================================================
# SIB Central Server Configuration
# =============================================================================

sib_server: "192.168.1.196"

# Stack selection for fleet collectors: vm or grafana
# vm = VictoriaLogs + VictoriaMetrics (default, uses vmagent + node_exporter)
# grafana = Loki + Prometheus (uses Alloy)
sib_stack: "vm"

# Grafana stack endpoints (Loki + Prometheus)
sib_loki_url: "http://{{ sib_server }}:3100"
sib_prometheus_url: "http://{{ sib_server }}:9090"

# VM stack endpoints (VictoriaLogs + VictoriaMetrics)
sib_victorialogs_url: "http://{{ sib_server }}:9428"
sib_victoriametrics_url: "http://{{ sib_server }}:8428"

# =============================================================================
# Docker Configuration (Static Binary Installation)
# =============================================================================

docker_static_version: "24.0.7"

# Install Docker if not present? (using static binaries)
# If false and Docker is missing, will fall back to native packages
install_docker_if_missing: true

# =============================================================================
# Deployment Strategy
# =============================================================================
# auto   - Detect Docker, use containers if available, native if not
# docker - Force Docker containers (will install Docker if missing)
# native - Force native packages (no Docker required)
deployment_strategy: auto

# =============================================================================
# Falco Configuration
# =============================================================================

falco_version: "0.40.0"
falco_priority: "notice"  # debug, info, notice, warning, error, critical

# Custom rules to deploy (from detection/config/rules/)
falco_custom_rules:
  - custom_rules.yaml

# Falco outputs - send to central Falcosidekick
falco_outputs:
  http_enabled: true
  http_url: "{{ 'https' if mtls_enabled | default(false) else 'http' }}://{{ sib_server }}:2801"

# =============================================================================
# mTLS Configuration (Fleet Security)
# =============================================================================

# Enable mutual TLS for encrypted communication between fleet and server
# Requires certificates: run 'make generate-certs' and 'make generate-fleet-certs'
mtls_enabled: true

# Certificate paths on fleet hosts (set by certs role)
mtls_cert_dir: /etc/sib/certs
mtls_ca_cert: "{{ mtls_cert_dir }}/ca.crt"
mtls_client_cert: "{{ mtls_cert_dir }}/client.crt"
mtls_client_key: "{{ mtls_cert_dir }}/client.key"

# =============================================================================
# Alloy Configuration (Log & Metrics Shipper)
# =============================================================================

alloy_version: "v1.5.1"

# Alloy deployment method: auto (uses deployment_strategy), docker, or native
alloy_deployment: auto

# What to collect
alloy_collect_logs: true
alloy_collect_metrics: true
alloy_collect_docker_logs: true
alloy_collect_journal: true

# Metric scrape targets (local to each host)
alloy_scrape_targets:
  - job: node
    port: 9100
    metrics_path: /metrics

# =============================================================================
# VM Collectors Configuration (vmagent + node_exporter)
# =============================================================================
# Used when sib_stack: vm

vmagent_image: "victoriametrics/vmagent:latest"
node_exporter_image: "prom/node-exporter:latest"
vector_image: "timberio/vector:latest-alpine"

# Collector deployment strategy (VM stack)
# auto   - Use Docker if available, otherwise skip (VM collectors require Docker)
# docker - Force Docker containers
collector_deployment: auto

# =============================================================================
# Common Settings
# =============================================================================

# Timezone for all hosts
timezone: "UTC"

# Package manager (auto-detected, but can override)
# package_manager: apt  # or yum, dnf

# Docker settings
docker_network: "sib-fleet"

# Logging
log_level: info
